import React, { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useAuth } from '../../../shared/context/AuthContext';
import OrderHistory from './OrderHistory';
import './AccountPage.css';

const AccountPage = () => {
  const navigate = useNavigate();
  const { user, logout } = useAuth();
  const [activeTab, setActiveTab] = useState('overview');

  const handleLogout = async () => {
    await logout();
    navigate('/');
  };

  if (!user) {
    return (
      <div className="account-page">
        <div className="account-container">
          <div className="not-logged-in">
            <h2>Please Log In</h2>
            <p>You need to be logged in to view your account</p>
            <Link to="/login" className="btn-primary">
              Go to Login
            </Link>
          </div>
        </div>
      </div>
    );
  }

  const menuItems = [
    { id: 'overview', label: 'Account Overview', icon: '👤' },
    { id: 'orders', label: 'My Orders', icon: '📦' },
    { id: 'profile', label: 'Profile Settings', icon: '⚙️' },
    { id: 'addresses', label: 'Saved Addresses', icon: '📍' },
    { id: 'wishlist', label: 'Wishlist', icon: '❤️' },
    { id: 'security', label: 'Security', icon: '🔒' }
  ];

  return (
    <div className="account-page">
      <div className="account-container">
        <div className="account-header">
          <div className="user-welcome">
            <div className="user-avatar">
              {user.full_name?.charAt(0).toUpperCase() || 'U'}
            </div>
            <div>
              <h1>Welcome back, {user.full_name}!</h1>
              <p>{user.email}</p>
            </div>
          </div>
          <button onClick={handleLogout} className="btn-logout">
            Logout
          </button>
        </div>

        <div className="account-content">
          <aside className="account-sidebar">
            <nav className="account-nav">
              {menuItems.map(item => (
                <button
                  key={item.id}
                  className={`nav-item ${activeTab === item.id ? 'active' : ''}`}
                  onClick={() => setActiveTab(item.id)}
                >
                  <span className="nav-icon">{item.icon}</span>
                  <span>{item.label}</span>
                </button>
              ))}
            </nav>
          </aside>

          <main className="account-main">
            {activeTab === 'overview' && <AccountOverview user={user} />}
            {activeTab === 'orders' && <OrderHistory />}
            {activeTab === 'profile' && <ProfileSection user={user} />}
            {activeTab === 'addresses' && <AddressesSection />}
            {activeTab === 'wishlist' && <WishlistSection />}
            {activeTab === 'security' && <SecuritySection />}
          </main>
        </div>
      </div>
    </div>
  );
};

// Account Overview Component
const AccountOverview = ({ user }) => {
  const stats = [
    { label: 'Total Orders', value: '0', icon: '📦' },
    { label: 'Wishlist Items', value: '0', icon: '❤️' },
    { label: 'Saved Addresses', value: '0', icon: '📍' },
    { label: 'Member Since', value: 'Oct 2025', icon: '📅' }
  ];

  return (
    <div className="section-content">
      <h2>Account Overview</h2>
      
      <div className="stats-grid">
        {stats.map((stat, index) => (
          <div key={index} className="stat-card">
            <div className="stat-icon">{stat.icon}</div>
            <div className="stat-info">
              <div className="stat-value">{stat.value}</div>
              <div className="stat-label">{stat.label}</div>
            </div>
          </div>
        ))}
      </div>

      <div className="quick-actions">
        <h3>Quick Actions</h3>
        <div className="action-grid">
          <Link to="/all-products" className="action-card">
            <span className="action-icon">🛍️</span>
            <span>Continue Shopping</span>
          </Link>
          <button className="action-card">
            <span className="action-icon">📦</span>
            <span>Track Order</span>
          </button>
          <button className="action-card">
            <span className="action-icon">❤️</span>
            <span>View Wishlist</span>
          </button>
          <button className="action-card">
            <span className="action-icon">💬</span>
            <span>Contact Support</span>
          </button>
        </div>
      </div>

      <div className="recent-activity">
        <h3>Recent Activity</h3>
        <div className="activity-list">
          <div className="activity-item">
            <span className="activity-icon">👋</span>
            <div className="activity-details">
              <p className="activity-title">Welcome to our store!</p>
              <p className="activity-time">Just now</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
};

// Profile Section Component
const ProfileSection = ({ user }) => {
  return (
    <div className="section-content">
      <h2>Profile Settings</h2>
      <div className="profile-form">
        <div className="form-group">
          <label>Full Name</label>
          <input type="text" defaultValue={user.full_name} />
        </div>
        <div className="form-group">
          <label>Email</label>
          <input type="email" defaultValue={user.email} disabled />
        </div>
        <div className="form-group">
          <label>Phone</label>
          <input type="tel" defaultValue={user.phone} />
        </div>
        <button className="btn-primary">Save Changes</button>
      </div>
    </div>
  );
};

// Addresses Section Component
const AddressesSection = () => {
  return (
    <div className="section-content">
      <h2>Saved Addresses</h2>
      <div className="empty-state">
        <div className="empty-icon">📍</div>
        <h3>No Saved Addresses</h3>
        <p>Add an address for faster checkout</p>
        <button className="btn-primary">Add Address</button>
      </div>
    </div>
  );
};

// Wishlist Section Component
const WishlistSection = () => {
  return (
    <div className="section-content">
      <h2>My Wishlist</h2>
      <div className="empty-state">
        <div className="empty-icon">❤️</div>
        <h3>Your Wishlist is Empty</h3>
        <p>Save your favorite products here</p>
        <Link to="/all-products" className="btn-primary">
          Discover Products
        </Link>
      </div>
    </div>
  );
};

// Security Section Component
const SecuritySection = () => {
  return (
    <div className="section-content">
      <h2>Security Settings</h2>
      <div className="profile-form">
        <div className="form-group">
          <label>Current Password</label>
          <input type="password" placeholder="Enter current password" />
        </div>
        <div className="form-group">
          <label>New Password</label>
          <input type="password" placeholder="Enter new password" />
        </div>
        <div className="form-group">
          <label>Confirm New Password</label>
          <input type="password" placeholder="Confirm new password" />
        </div>
        <button className="btn-primary">Change Password</button>
      </div>
    </div>
  );
};

export default AccountPage;
